import { Head, Appear } from 'mdx-deck'

export { future as theme } from 'mdx-deck/themes'

<Head>
  <title>Rustで言語処理系を書くと楽しい</title>
</Head>

# Rustで
# 言語処理系を
# 書くと楽しい

---

## 私

- @coord_e (こーでぃ)
- C++erだった高校生
- Rust歴は一ヶ月ちょっと
- https://github.com/coord-e

---

## 最近Rustを触り始めた話

---

## 「Rust, やるつもり」
<Appear>
  <h4>と無限に言ってRustを始めない人生を送っていた</h4>
</Appear>

---

### ところがある日
<Appear>
  <h2>彼女がRust本を買った</h2>
</Appear>

---

## 今しかない!!

---

## やったこと

<Appear>
  <li>The Rust Programming Languageを読んだ</li>
  <li>Rustで書かれたソースを読んでみた(rapidusとか)</li>
  <li>いろいろRustで書くようになった</li>
</Appear>

---

## Rustのここが好き!!

- 代数的データ型とパターンマッチ!!
- `?`!!!`?`すごい!!!
- トレイトの用途が柔軟すぎて泣いた
- 基本的に暗黙のコピーがない
- セグフォしない
- `cargo`有能スギィ!

---

## Rustのここにつまづく!!

- モジュールが、Python/JSから来た僕から見るとちょっとわかりにくい
- ****ライフタイム****
- selfの借用とか...

---

## つまづきポイントはどうにかなる!!

- いろんなRustで書かれたコードを読めばだんだんわかってくる!
- ライフタイムはまだよくわからんけど、コンパイラはごまかせるようになってきた!
- Twitterで聞いてみると、すごい人たちが教えてくれる!! ありがとうございます!

---

# さて、

---

## 自作言語を書いています。

- C++を学んんだときも自作言語を書きながらだったので...
- 探したらパーサライブラリも良さそうなのがあったので、やってみることに

---

## Rustは言語処理系が書きやすい
(なお独断と偏見)

---

## `Enum`と`match`

```rust
enum Expression {
  Number(i64),
  Boolean(bool),
  Add(Box<Expression>, Box<Expression>)
}
```

`std::variant`の悪夢...

---

## `Enum`と`match`

```rust
fn eval(expr) -> i64 {
  match expr {
    Number(n) => n,
    Boolean(tf) => tf as i64,
    Add(lhs, rhs) => eval(*lhs) + eval(*rhs)
  }
}
```

`std::visit`...

---

## おまけ: 作っている処理系の紹介

---

## 構成

### `rust-peg`
- <https://github.com/kevinmehall/rust-peg>
- PEG (Parsing Expression Grammer)で定義した文法からパーサのコードを生成してくれる

### `cranelift`
- <https://github.com/CraneStation/cranelift>
- IRから実行コード生成

---

## テーマ

- 全部式
- Rustの式ベースの便利さに感動したので、いっそのこと全て式で表現する言語を作ってみようと思った
- `;`を二項演算子として扱う
- 両辺を評価し、右辺の値を返す
- これで複数の式をいかにも文のように並べられる

---

<https://github.com/coord-e/expressi>

---

# ありがとうございました
